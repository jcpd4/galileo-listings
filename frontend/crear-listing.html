<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Crear Listing</title>
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="css/sb-admin-2.min.css" rel="stylesheet">
</head>
<body id="page-top">

<div class="container mt-5">
  <h1 class="h3 mb-4 text-gray-800">Crear nuevo listing</h1>

  <form id = "form-listing">
    <div class="form-group">
      <label for="titulo">Título del producto</label>
      <input type="text" class="form-control" id="titulo" placeholder="Introduce el título...">
    </div>

    <div class="form-group">
      <label for="bullets">Bullet points</label>
      <textarea class="form-control" id="bullets" rows="3" placeholder="• Punto 1\n• Punto 2..."></textarea>
    </div>

    <div class="form-group">
      <label for="descripcion">Descripción</label>
      <textarea class="form-control" id="descripcion" rows="4"></textarea>
    </div>

    <div class="form-group">
      <label for="keywords">Palabras clave</label>
      <input type="text" class="form-control" id="keywords" placeholder="ej: planner, organizador...">
    </div>

    <button type="submit" class="btn btn-primary">Guardar</button>
    <a href="mis-productos.html" class="btn btn-secondary">Cancelar</a>
  </form>
</div>

<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script>
    const params = new URLSearchParams(window.location.search);
    const editIndex = params.get("edit");

    const tituloInput = document.getElementById("titulo");
    const bulletsInput = document.getElementById("bullets");
    const descripcionInput = document.getElementById("descripcion");
    const keywordsInput = document.getElementById("keywords");

    if (editIndex !== null) {
        const productos = JSON.parse(localStorage.getItem("productos")) || [];
        const producto = productos[editIndex];

        if (producto) {
            tituloInput.value = producto.titulo;
            bulletsInput.value = producto.bullets;
            descripcionInput.value = producto.descripcion;
            keywordsInput.value = producto.keywords;
        }
    }

    document.getElementById("form-listing").addEventListener("submit", function (e) {
        e.preventDefault();

        const nuevoProducto = {
            titulo: tituloInput.value,
            bullets: bulletsInput.value,
            descripcion: descripcionInput.value,
            keywords: keywordsInput.value
        };

        let productos = JSON.parse(localStorage.getItem("productos")) || [];

        if (editIndex !== null && productos[editIndex]) {
            productos[editIndex] = nuevoProducto;
        } else {
            productos.push(nuevoProducto);
        }

        localStorage.setItem("productos", JSON.stringify(productos));

        // ✅ Redirección al listado de productos
        window.location.href = "mis-productos.html";
    });
</script>

  
</body>
</html>